<? //Funcion que calcula el Stock Disponible de la Hornada.
	function StockActual($hornada,$producto,$sub_producto) 	
	{		
		$stock_actual = 0;
		//Busca el Stock Inicial de la Hornada ( Recepcion) (+).
		$consulta = "SELECT * FROM sea_web.hornadas WHERE cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
		$consulta = $consulta." AND hornada_ventana = ".$hornada;	
		//echo ".......0...".$consulta."<br>";
		$rs = mysql_query($consulta);
		
		if ($row = mysql_fetch_array($rs))
		{
		
			$stock_actual = $row["unidades"];
			
			//Busca los Beneficios (-). (tipo 2)
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 2 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			//echo "...1...".$consulta."<br>";			
			$rs1 = mysql_query($consulta);
			$row1 = mysql_fetch_array($rs1);
			$stock_actual = $stock_actual - $row1[unid_mov];
				
			//Busca los Traspasos (-). (tipo 4)
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 4 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			//echo "..........3....".$consulta."<br>";
			$rs2 = mysql_query($consulta);
			$row2 = mysql_fetch_array($rs2);
			$stock_actual = $stock_actual - $row2[unid_mov];
/*			
			//Busca los Rechazados por el Inspector(-). (tipo 6)
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 6 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;			$consulta = $consulta." AND hornada = ".$hornada;
			$rs2 = mysql_query($consulta);
			$row2 = mysql_fetch_array($rs2);
			$stock_actual = $stock_actual - $row2[unid_mov];
*/
/*			//Busca los Aprobados a RAF (-). (tipo 7)
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 7 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			$rs3 = mysql_query($consulta);
			$row3 = mysql_fetch_array($rs3);
			$stock_actual = $stock_actual - $row3[unid_mov];
*/						
/*			//Busca los Rechazados a N.E (+). (tipo 8)				
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 8 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			$rs4 = mysql_query($consulta);
			$row4 = mysql_fetch_array($rs4);
			$stock_actual = $stock_actual + $row4[unid_mov];						
*/
				
			//Busca los Envios de Anodos Buenos(-). (tipo 9)
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 9 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			//echo ".......4.....".$consulta."<br>";			
			$rs5 = mysql_query($consulta);
			$row5 = mysql_fetch_array($rs5);
			$stock_actual = $stock_actual - $row5[unid_mov];																
		}
		return $stock_actual;
	}	
	
	
	//Funcion que calcula los Anodos Rechazados de la Hornada.
	function StockRechazo($hornada,$producto,$sub_producto)
	{
		$stock_actual = 0;
		//Busca los Rechazos del Inspector (+). (tipo 6)
		$consulta = "SELECT * FROM sea_web.movimientos WHERE tipo_movimiento = 6 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
		$consulta = $consulta." AND hornada = ".$hornada;

		$rs = mysql_query($consulta);

		if ($row = mysql_fetch_array($rs))		
		{
			$stock_actual = $row["unidades"];
			
			//Busca los Aprobados a RAF (+). (tipo 7)
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 7 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			$rs1 = mysql_query($consulta);
			$row1 = mysql_fetch_array($rs1);
			$stock_actual = $stock_actual + $row1[unid_mov];
			
			//Busca los Rechazados a N.E (-). (tipo 8)				
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 8 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			$rs2 = mysql_query($consulta);
			$row2 = mysql_fetch_array($rs2);
			$stock_actual = $stock_actual - $row2[unid_mov];
			
			//Busca los Traspasos (-). (tipo 4)
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 4 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			$rs3 = mysql_query($consulta);
			$row3 = mysql_fetch_array($rs3);
			$stock_actual = $stock_actual - $row3[unid_mov];
			
			//Busca los Envios de Rechazos(-). (tipo 5)
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 5 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			$rs5 = mysql_query($consulta);
			$row5 = mysql_fetch_array($rs5);
			$stock_actual = $stock_actual - $row5[unid_mov];						
			
		}
		return $stock_actual;
	}	
	
	//Calcula el Stock de Resto de H.M.
	function StockRestoHM($hornada,$producto,$sub_producto)
	{
		$stock_actual = 0;
		
		$consulta = "SELECT * FROM sea_web.hornadas WHERE cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
		$consulta = $consulta." AND hornada_ventana = ".$hornada;
		$rs = mysql_query($consulta);
		if ($row = mysql_fetch_array($rs))
		{
			$stock_actual = $row["unidades"];
			$consulta = "SELECT IFNULL(SUM(unidades),0) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento IN(2,4) AND cod_producto = ".$producto;
			$consulta = $consulta." AND cod_subproducto = ".$sub_producto." AND hornada = ".$hornada;
			$rs1 = mysql_query($consulta);
			$row1 = mysql_fetch_array($rs1);
			$stock_actual = $stock_actual - $row1[unid_mov];
		}
		return $stock_actual;
	}
	
	//Calcula el Stock de Resto de Corriente.
	function StockRestoCTTE($hornada,$producto,$sub_producto)
	{
		$stock_actual = 0;
		$consulta = "SELECT SUM(unidades) AS unid_mov FROM sea_web.movimientos WHERE tipo_movimiento = 3 AND cod_producto = ".$producto;
		$consulta = $consulta." AND cod_subproducto = ".$sub_producto." AND hornada = ".$hornada;
		$rs = mysql_query($consulta);
		$row = mysql_fetch_array($rs);
		if (!is_null($row[unid_mov]))
			$stock_actual = $row[unid_mov];
		
		return $stock_actual;
	}
	
	
	//Funcion que cambia el estado a la Hornada para no volver a pescarla.
	function CambiaEstadoHornada($hornada,$producto,$sub_producto)
	{
		$actualiza = "UPDATE sea_web.hornadas SET estado = 1 WHERE cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto." AND hornada_ventana = ".$hornada;
		mysql_query($actualiza);		
	}
	
	function PesoFaltante ($cod_producto, $cod_subproducto, $hornada)
	{
		$consulta = "SELECT peso_unidades FROM sea_web.hornadas";
		$consulta = $consulta." WHERE cod_producto = ".$cod_producto." AND cod_subproducto = ".$cod_subproducto;
		$consulta = $consulta." AND hornada_ventana = ".$hornada;
		$rs = mysql_query($consulta);
		$row = mysql_fetch_array($rs);
		
		$StockPeso = $row[peso_unidades];		
	
		$consulta = "SELECT IFNULL(SUM(peso),0) AS peso FROM sea_web.movimientos";
		$consulta = $consulta." WHERE tipo_movimiento IN (2,4,9) and cod_producto = ".$cod_producto;
		$consulta = $consulta." AND cod_subproducto = ".$cod_subproducto." AND hornada = ".$hornada;
		$rs1 = mysql_query($consulta);
		$row1 = mysql_fetch_array($rs1);
		
		$StockPeso = $StockPeso - $row1["peso"];
		
		return $StockPeso;
	}
	
	function StockPesoActual($hornada,$producto,$sub_producto) 
	{
		$stock_actual = 0;
		//Busca el Stock Inicial de la Hornada ( Recepcion ï¿½ Produccion) (+).
		$consulta = "SELECT * FROM sea_web.hornadas WHERE cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
		$consulta = $consulta." AND hornada_ventana = ".$hornada;		
		$rs = mysql_query($consulta);
		
		if ($row = mysql_fetch_array($rs))
		{
			$stock_actual = $row[peso_unidades];
			
			//Busca los Beneficios (-). (tipo 2)
			$consulta = "SELECT IFNULL(SUM(peso),0) AS peso_mov FROM sea_web.movimientos WHERE tipo_movimiento = 2 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;			
			$rs1 = mysql_query($consulta);
			$row1 = mysql_fetch_array($rs1);
			$stock_actual = $stock_actual - $row1[peso_mov];
				
			//Busca los Traspasos (-). (tipo 4)
			$consulta = "SELECT IFNULL(SUM(peso),0) AS peso_mov FROM sea_web.movimientos WHERE tipo_movimiento = 4 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;
			$rs2 = mysql_query($consulta);
			$row2 = mysql_fetch_array($rs2);
			$stock_actual = $stock_actual - $row2[peso_mov];

				
			//Busca los Envios de Anodos Buenos(-). (tipo 9)
			$consulta = "SELECT IFNULL(SUM(peso),0) AS peso_mov FROM sea_web.movimientos WHERE tipo_movimiento = 9 AND cod_producto = ".$producto." AND cod_subproducto = ".$sub_producto;
			$consulta = $consulta." AND hornada = ".$hornada;			
			$rs5 = mysql_query($consulta);
			$row5 = mysql_fetch_array($rs5);
			$stock_actual = $stock_actual - $row5[peso_mov];																
		}
		return $stock_actual;	
	}
?>